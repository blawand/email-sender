<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template Email Sender</title>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-8">
                <h1>Template Email Sender</h1>
                
                <!-- CSV Upload Section -->
                <div class="mb-3">
                    <label for="csv-file" class="form-label">Upload CSV:</label>
                    <input type="file" name="csv_file" accept=".csv" id="csv-file" class="form-control" onchange="loadHeaders()" required>
                </div>

                <!-- File Upload Section -->
                <div class="mb-3">
                    <label for="attachments" class="form-label">Upload Files (Images/PDFs):</label>
                    <input type="file" name="attachments" id="attachments" class="form-control" multiple>
                </div>

                <form id="email-form" method="POST" enctype="multipart/form-data" action="/generate">
                    <!-- Recipient Email Section -->
                    <div class="mb-3">
                        <label for="recipient-email" class="form-label">Recipient Email:</label>
                        <input type="text" id="recipient-email" name="recipient_email" class="form-control" placeholder="Enter the recipient email (use {} for placeholders)" required>
                    </div>
                
                    <!-- Subject Line Section -->
                    <div class="mb-3">
                        <label for="subject" class="form-label">Email Subject:</label>
                        <input type="text" id="subject" name="subject" class="form-control" placeholder="Enter the email subject (use {} for placeholders)" required>
                    </div>
                
                    <!-- Body Section -->
                    <div class="mb-3">
                        <label for="template" class="form-label">Write your email template:</label>
                        <div id="editor-container"></div>
                        <input type="hidden" id="email-template" name="template">
                    </div>
                
                    <!-- Preview Button -->
                    <button type="button" class="btn btn-secondary" onclick="renderPreview()">See Preview</button>
                
                    <!-- Header Selection Section -->
                    <div id="header-selection" style="margin-top: 20px; overflow-y: auto; max-height: 150px;">
                        <!-- This is where the header selection dropdown will appear -->
                    </div>
                
                    <!-- Preview Section -->
                    <div id="preview-container" style="margin-top: 20px;">
                        <!-- This is where the preview will appear -->
                    </div>
                
                    <button type="submit" class="btn btn-primary">Generate and Send Emails</button>
                </form>  
                
            </div>

            <div class="col-md-4">
                <div id="help-section" class="card">
                    <div class="card-body">
                        <h5>How to Use Template Email Sender</h5>
                        <ul>
                            <li>Upload your CSV file with headers matching the placeholders you want to use.</li>
                            <li>Upload any files or images you want to attach to the emails.</li>
                            <li>Enter your email subject. You can use curly braces `{}` for placeholders.</li>
                            <li>Type your email body in the editor. Use curly braces `{}` for placeholders.</li>
                            <li>When you type `{`, a closing `}` will automatically be added. A dropdown will appear for you to select the CSV header that matches the placeholder.</li>
                            <li>Click "Generate and Send Emails" to process your emails.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>